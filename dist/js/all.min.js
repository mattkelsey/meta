function checkForPointerLock(){return"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document}function generateSurface(e,t){var n,o,i;return n=1e3*(e-.5),i=1e3*(t-.5),o=0,new THREE.Vector3(n,o,i)}function init(){initPointerLock(),initControls(),scene=new THREE.Scene;var e=window.innerWidth,t=window.innerHeight;renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setSize(e,t),document.body.appendChild(renderer.domElement),camera=new THREE.PerspectiveCamera(45,e/t,.1,2e4),camera.position.set(1,1,50),controls=new THREE.PointerLockControls(camera),scene.add(controls.getObject()),window.addEventListener("resize",function(){var e=window.innerWidth,t=window.innerHeight;renderer.setSize(e,t),camera.aspect=e/t,camera.updateProjectionMatrix()}),renderer.setClearColor(3358535,1);var n=new THREE.PointLight(16777215);n.position.set(-100,200,100),scene.add(n);var o=new THREE.MeshPhongMaterial({color:"purple",specular:131586,side:THREE.DoubleSide}),i=new THREE.ParametricGeometry(generateSurface,64,64),a=new THREE.Mesh(i,o);scene.add(a)}function animate(){requestAnimationFrame(animate),renderer.render(scene,camera),updateControls()}function initPointerLock(){var e=document.body;if(hasPointerLock){var t=function(t){document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e?(controlsEnabled=!0,controls.enabled=!0):(controlsEnabled=!1,controls.enabled=!1)},n=function(t){e.innerHTML="PointerLock Error"};document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("pointerlockerror",n,!1),document.addEventListener("mozpointerlockerror",n,!1),document.addEventListener("webkitpointerlockerror",n,!1);var o=function(t){e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock()};e.addEventListener("click",o,!1)}else e.innerHTML="Bad browser; No pointer lock"}function initControls(){document.addEventListener("keydown",onKeyDown,!1),document.addEventListener("keyup",onKeyUp,!1)}function updateControls(){if(controlsEnabled){var e=clock.getDelta(),t=2e3;velocity.x-=10*velocity.x*e,velocity.z-=10*velocity.z*e,velocity.y-=9.8*100*e,moveForward&&(velocity.z-=t*e),moveBackward&&(velocity.z+=t*e),moveLeft&&(velocity.x-=t*e),moveRight&&(velocity.x+=t*e),controls.getObject().translateX(velocity.x*e),controls.getObject().translateY(velocity.y*e),controls.getObject().translateZ(velocity.z*e),controls.getObject().position.y<10&&(velocity.y=0,controls.getObject().position.y=10,canJump=!0)}}function onKeyDown(e){switch(e.keyCode){case 38:case 87:moveForward=!0;break;case 37:case 65:moveLeft=!0;break;case 40:case 83:moveBackward=!0;break;case 39:case 68:moveRight=!0;break;case 32:canJump===!0&&(velocity.y+=350),canJump=!1}}function onKeyUp(e){switch(e.keyCode){case 38:case 87:moveForward=!1;break;case 37:case 65:moveLeft=!1;break;case 40:case 83:moveBackward=!1;break;case 39:case 68:moveRight=!1}}THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*h.autoRotateSpeed}function o(){return Math.pow(.95,h.zoomSpeed)}function i(e){if(h.enabled!==!1){if(e.preventDefault(),0===e.button){if(h.noRotate===!0)return;C=x.ROTATE,p.set(e.clientX,e.clientY)}else if(1===e.button){if(h.noZoom===!0)return;C=x.DOLLY,L.set(e.clientX,e.clientY)}else if(2===e.button){if(h.noPan===!0)return;C=x.PAN,f.set(e.clientX,e.clientY)}document.addEventListener("mousemove",a,!1),document.addEventListener("mouseup",r,!1),h.dispatchEvent(S)}}function a(e){if(h.enabled!==!1){e.preventDefault();var t=h.domElement===document?h.domElement.body:h.domElement;if(C===x.ROTATE){if(h.noRotate===!0)return;E.set(e.clientX,e.clientY),v.subVectors(E,p),h.rotateLeft(2*Math.PI*v.x/t.clientWidth*h.rotateSpeed),h.rotateUp(2*Math.PI*v.y/t.clientHeight*h.rotateSpeed),p.copy(E)}else if(C===x.DOLLY){if(h.noZoom===!0)return;T.set(e.clientX,e.clientY),g.subVectors(T,L),g.y>0?h.dollyIn():h.dollyOut(),L.copy(T)}else if(C===x.PAN){if(h.noPan===!0)return;b.set(e.clientX,e.clientY),y.subVectors(b,f),h.pan(y.x,y.y),f.copy(b)}h.update()}}function r(){h.enabled!==!1&&(document.removeEventListener("mousemove",a,!1),document.removeEventListener("mouseup",r,!1),h.dispatchEvent(N),C=x.NONE)}function c(e){if(h.enabled!==!1&&h.noZoom!==!0){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?h.dollyOut():h.dollyIn(),h.update(),h.dispatchEvent(S),h.dispatchEvent(N)}}function s(e){if(h.enabled!==!1&&h.noKeys!==!0&&h.noPan!==!0)switch(e.keyCode){case h.keys.UP:h.pan(0,h.keyPanSpeed),h.update();break;case h.keys.BOTTOM:h.pan(0,-h.keyPanSpeed),h.update();break;case h.keys.LEFT:h.pan(h.keyPanSpeed,0),h.update();break;case h.keys.RIGHT:h.pan(-h.keyPanSpeed,0),h.update()}}function d(e){if(h.enabled!==!1){switch(e.touches.length){case 1:if(h.noRotate===!0)return;C=x.TOUCH_ROTATE,p.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(h.noZoom===!0)return;C=x.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);L.set(0,o);break;case 3:if(h.noPan===!0)return;C=x.TOUCH_PAN,f.set(e.touches[0].pageX,e.touches[0].pageY);break;default:C=x.NONE}h.dispatchEvent(S)}}function l(e){if(h.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=h.domElement===document?h.domElement.body:h.domElement;switch(e.touches.length){case 1:if(h.noRotate===!0)return;if(C!==x.TOUCH_ROTATE)return;E.set(e.touches[0].pageX,e.touches[0].pageY),v.subVectors(E,p),h.rotateLeft(2*Math.PI*v.x/t.clientWidth*h.rotateSpeed),h.rotateUp(2*Math.PI*v.y/t.clientHeight*h.rotateSpeed),p.copy(E),h.update();break;case 2:if(h.noZoom===!0)return;if(C!==x.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(n*n+o*o);T.set(0,i),g.subVectors(T,L),g.y>0?h.dollyOut():h.dollyIn(),L.copy(T),h.update();break;case 3:if(h.noPan===!0)return;if(C!==x.TOUCH_PAN)return;b.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(b,f),h.pan(y.x,y.y),f.copy(b),h.update();break;default:C=x.NONE}}}function u(){h.enabled!==!1&&(h.dispatchEvent(N),C=x.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var h=this,m=1e-6,p=new THREE.Vector2,E=new THREE.Vector2,v=new THREE.Vector2,f=new THREE.Vector2,b=new THREE.Vector2,y=new THREE.Vector2,k=new THREE.Vector3,w=new THREE.Vector3,L=new THREE.Vector2,T=new THREE.Vector2,g=new THREE.Vector2,R=0,H=0,P=1,O=new THREE.Vector3,M=new THREE.Vector3,j=new THREE.Quaternion,x={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},C=x.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone();var D=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),V=D.clone().inverse(),Y={type:"change"},S={type:"start"},N={type:"end"};this.rotateLeft=function(e){void 0===e&&(e=n()),H-=e},this.rotateUp=function(e){void 0===e&&(e=n()),R-=e},this.panLeft=function(e){var t=this.object.matrix.elements;k.set(t[0],t[1],t[2]),k.multiplyScalar(-e),O.add(k)},this.panUp=function(e){var t=this.object.matrix.elements;k.set(t[4],t[5],t[6]),k.multiplyScalar(e),O.add(k)},this.pan=function(e,t){var n=h.domElement===document?h.domElement.body:h.domElement;if(void 0!==h.object.fov){var o=h.object.position,i=o.clone().sub(h.target),a=i.length();a*=Math.tan(h.object.fov/2*Math.PI/180),h.panLeft(2*e*a/n.clientHeight),h.panUp(2*t*a/n.clientHeight)}else void 0!==h.object.top?(h.panLeft(e*(h.object.right-h.object.left)/n.clientWidth),h.panUp(t*(h.object.top-h.object.bottom)/n.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=o()),P/=e},this.dollyOut=function(e){void 0===e&&(e=o()),P*=e},this.update=function(){var e=this.object.position;w.copy(e).sub(this.target),w.applyQuaternion(D);var t=Math.atan2(w.x,w.z),o=Math.atan2(Math.sqrt(w.x*w.x+w.z*w.z),w.y);this.autoRotate&&this.rotateLeft(n()),t+=H,o+=R,o=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o)),o=Math.max(m,Math.min(Math.PI-m,o));var i=w.length()*P;i=Math.max(this.minDistance,Math.min(this.maxDistance,i)),this.target.add(O),w.x=i*Math.sin(o)*Math.sin(t),w.y=i*Math.cos(o),w.z=i*Math.sin(o)*Math.cos(t),w.applyQuaternion(V),e.copy(this.target).add(w),this.object.lookAt(this.target),H=0,R=0,P=1,O.set(0,0,0),(M.distanceToSquared(this.object.position)>m||8*(1-j.dot(this.object.quaternion))>m)&&(this.dispatchEvent(Y),M.copy(this.object.position),j.copy(this.object.quaternion))},this.reset=function(){C=x.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.update()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",d,!1),this.domElement.addEventListener("touchend",u,!1),this.domElement.addEventListener("touchmove",l,!1),window.addEventListener("keydown",s,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.PointerLockControls=function(e){var t=this;e.rotation.set(0,0,0);var n=new THREE.Object3D;n.add(e);var o=new THREE.Object3D;o.position.y=10,o.add(n);var i=Math.PI/2,a=function(e){if(t.enabled!==!1){var a=e.movementX||e.mozMovementX||e.webkitMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||0;o.rotation.y-=.002*a,n.rotation.x-=.002*r,n.rotation.x=Math.max(-i,Math.min(i,n.rotation.x))}};this.dispose=function(){document.removeEventListener("mousemove",a,!1)},document.addEventListener("mousemove",a,!1),this.enabled=!1,this.getObject=function(){return o},this.getDirection=function(){var e=new THREE.Vector3(0,0,-1),t=new THREE.Euler(0,0,0,"YXZ");return function(i){return t.set(n.rotation.x,o.rotation.y,0),i.copy(e).applyEuler(t),i}}()};var scene,camera,renderer,moveForward,moveBackward,moveLeft,moveRight,canJump,hasPointerLock=checkForPointerLock(),velocity=new THREE.Vector3,clock=new THREE.Clock,controlsEnabled;init(),animate();